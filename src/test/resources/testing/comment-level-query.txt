SELECT new com.km.commentservice.dto.CommentReply(c.id as id, c.user as user, c.body as body, c.parentId as parentId, (SELECT COUNT(*) FROM Comment cc where cc.path LIKE (CONCAT(c.path,'%')) AND cc.path != c.path) as replies, SUM(CASE WHEN rc.id.reactionType = 0 THEN rc.count ELSE 0 END) AS likeCount, SUM(CASE WHEN rc.id.reactionType = 1 THEN rc.count ELSE 0 END) AS dislikeCount, c.level as level, c.createdAt as created, c.updatedAt updated, c.isDeleted as isDeleted) from Comment c LEFT JOIN ReactionCount rc on c.id = rc.id.commentId where c.path LIKE (CONCAT(:commentId,'%')) AND level = :level GROUP BY c.id ORDER BY c.path